
# ğŸ“¡ tb_control_service
## Overview

tb_control_service à¹€à¸›à¹‡à¸™ Service à¸à¸¥à¸²à¸‡à¸ªà¸³à¸«à¸£à¸±à¸šà¸£à¸±à¸šà¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸ˆà¸²à¸ ThingsBoard
à¸—à¸³à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¹à¸›à¸¥à¸‡ RPC / Attribute Update à¸ˆà¸²à¸ ThingsBoard
à¹ƒà¸«à¹‰à¸à¸¥à¸²à¸¢à¹€à¸›à¹‡à¸™à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸ à¸²à¸¢à¹ƒà¸™à¸£à¸°à¸šà¸š Smart-Shop

## Responsibilities

* subscribe RPC à¸ˆà¸²à¸ ThingsBoard (MQTT)
* validate + parse command
* forward command à¹€à¸‚à¹‰à¸² Smart-Shop à¸œà¹ˆà¸²à¸™ ZeroMQ
* à¸ªà¹ˆà¸‡ RPC response à¸à¸¥à¸±à¸š ThingsBoard

## Architecture
~~~
ThingsBoard
   |
   |  RPC (MQTT)
   v
+--------------------+
| tb_control_service |
+--------------------+
        |
        | ZMQ request
        v
 [ uplink_service / other services ]
~~~
## Supported RPC Methods
update_uplink_config

à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸›à¸´à¸”/à¸›à¸´à¸” uplink à¹à¸¥à¸°à¸›à¸£à¸±à¸š interval à¹à¸šà¸š runtime

RPC Payload (ThingsBoard)
~~~
{
  "uplinks": [
    {
      "name": "http_test",
      "enabled": false
    },
    {
      "name": "thingsboard",
      "interval_sec": 30
    }
  ]
}
~~~
## Effect
* à¹à¸à¹‰ config.yaml
* uplink_service reload config à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
* à¹„à¸¡à¹ˆà¸¡à¸µ restart service

## ThingsBoard UI Setup (Summary)
* Device â†’ RPC
* Method: update_uplink_config
* Type: Server-side RPC
* Payload: JSON (à¸•à¸²à¸¡ schema à¸”à¹‰à¸²à¸™à¸šà¸™)

##Run
~~~
python3 -m services.tb_control_service.tb_control_service
~~~

## Logs (à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡)
~~~
[tb_control_service] RPC update_uplink_config received
[tb_control_service] forward to uplink_service
[tb_control_service] response sent to ThingsBoard
~~~

## Design Notes
* tb_control_service à¹„à¸¡à¹ˆà¹à¸à¹‰ config à¹€à¸­à¸‡
* uplink_service à¹€à¸›à¹‡à¸™ owner à¸‚à¸­à¸‡ uplink runtime state
* à¸£à¸­à¸‡à¸£à¸±à¸šà¸à¸²à¸£à¸‚à¸¢à¸²à¸¢à¹„à¸›à¸„à¸§à¸šà¸„à¸¸à¸¡ service à¸­à¸·à¹ˆà¸™ (GPIO, Modbus, AI, à¸¯à¸¥à¸¯)

## Roadmap (Optional)
* ACL per RPC method
* Config validation schema
* Versioned config
* Audit log (who changed what)

# ğŸ¤ License

à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œà¸™à¸µà¹‰à¹ƒà¸Šà¹‰à¸ à¸²à¸¢à¹ƒà¸™ Smartshop AI / DTC Enterprise

# ğŸ’— Contact

à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œ
>Pâ€™ Jum â€” AIoT R&D & Sourcing Manager   
>Pink - Assistance  
>D.T.C. Enterprise
