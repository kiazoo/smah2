# ğŸ“¦ uplink_service
## Overview

uplink_service à¹€à¸›à¹‡à¸™ Service à¸à¸¥à¸²à¸‡ (Central Uplink Gateway) à¸‚à¸­à¸‡ Smart-Shop Platform
à¸—à¸³à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸£à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ service à¸ à¸²à¸¢à¹ƒà¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” à¹à¸¥à¹‰à¸§à¸ˆà¸±à¸”à¸à¸²à¸£à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸¶à¹‰à¸™ platform à¸ à¸²à¸¢à¸™à¸­à¸ à¹€à¸Šà¹ˆà¸™
* ThingsBoard (HTTP / MQTT)
* HTTP Endpoint (Node-RED, Backend à¸­à¸·à¹ˆà¸™)
* MQTT Broker à¸ à¸²à¸¢à¸™à¸­à¸

à¹‚à¸”à¸¢à¸£à¸­à¸‡à¸£à¸±à¸š:
* multi-uplink
* runtime enable/disable
* buffering + retry
* hot-reload config
* health snapshot integration

## Responsibilities

* à¸£à¸±à¸š push_data à¸ˆà¸²à¸ internal services à¸œà¹ˆà¸²à¸™ ZeroMQ
* aggregate à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¹ˆà¸­ uplink à¹à¸šà¸š stateful
* à¸”à¸¶à¸‡ health snapshot à¸ˆà¸²à¸ health_service
* à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸¶à¹‰à¸™ platform à¸•à¸²à¸¡ schedule
* buffer à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸¡à¸·à¹ˆà¸­à¸ªà¹ˆà¸‡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¹à¸¥à¸° flush à¹€à¸¡à¸·à¹ˆà¸­à¸à¸¥à¸±à¸šà¸¡à¸² online
* à¸£à¸±à¸š config update à¸ˆà¸²à¸ ThingsBoard RPC (à¸œà¹ˆà¸²à¸™ tb_control_service)

## Architecture
~~~
[ internal services ]
        |
        |  push_data (ZMQ)
        v
+--------------------+
|  uplink_service    |
|--------------------|
| Aggregator         |
| BufferStore        |
| HealthClient       |
| ConfigManager      |
+--------------------+
   |        |        |
   |        |        |
ThingsBoard  HTTP   MQTT
~~~

## Payload Flow
### Input (push_data)
~~~
{
  "source": "sensor_1",
  "data": {
    "temperature": 29.4,
    "humidity": 74
  }
}
~~~
### Output (uplink payload)
~~~
{
  "device_id": "SMARTSHOP-001",
  "timestamp": "2025-12-21T14:36:01.503Z",
  "services": {
    "sensor_1": {
      "temperature": 29.4,
      "humidity": 74
    }
  },
  "health": {
    "status": "ok",
    "cpu": 32.1,
    "ram": 41.2
  }
}
~~~
## Configuration

ğŸ“„ services/uplink_service/config.yaml
~~~
device:
  id: SMARTSHOP-001

broker:
  address: tcp://127.0.0.1:5555

uplinks:
  - name: thingsboard
    type: thingsboard
    enabled: true
    protocol: http
    host: xio.dtciot.com
    token: XXXXX
    interval_sec: 10

  - name: http_test
    type: http
    enabled: true
    url: http://203.150.210.39:8900/uplink
    interval_sec: 10
~~~

âš ï¸ config à¸ªà¸²à¸¡à¸²à¸£à¸–à¸–à¸¹à¸à¹à¸à¹‰ runtime à¸œà¹ˆà¸²à¸™ ThingsBoard RPC à¹„à¸”à¹‰

## Runtime Behavior
* à¸–à¹‰à¸² à¹„à¸¡à¹ˆà¸¡à¸µ data à¹ƒà¸«à¸¡à¹ˆ â†’ à¹„à¸¡à¹ˆà¸¢à¸´à¸‡ uplink
* à¸–à¹‰à¸² à¸ªà¹ˆà¸‡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ â†’ à¹€à¸à¹‡à¸šà¸¥à¸‡ buffer
* à¸–à¹‰à¸² server à¸à¸¥à¸±à¸šà¸¡à¸² â†’ flush buffer à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
* health à¸ˆà¸°à¸ªà¹ˆà¸‡à¹€à¸‰à¸à¸²à¸°à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸„à¹ˆà¸²

## Run
~~~
python3 -m services.uplink_service.uplink_service
~~~
## Logs (à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡)
~~~
[uplink_service] RECV push_data from=sensor_service
[uplink_service] sent uplink=http_test
[uplink_service] sent uplink=thingsboard
~~~
## Key Design Decisions
* Aggregator à¹à¸¢à¸ state à¸•à¹ˆà¸­ uplink
* device_id / timestamp à¸–à¸¹à¸ enforce à¸—à¸µà¹ˆ uplink layer
* uplink_service à¹„à¸¡à¹ˆà¸ªà¸™à¹ƒà¸ˆ schema à¸ à¸²à¸¢à¹ƒà¸™à¸‚à¸­à¸‡ service
* HTTP uplink à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰ 4xx/5xx à¸ªà¸³à¸«à¸£à¸±à¸š telemetry validation

# ğŸ¤ License

à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œà¸™à¸µà¹‰à¹ƒà¸Šà¹‰à¸ à¸²à¸¢à¹ƒà¸™ Smartshop AI / DTC Enterprise

# ğŸ’— Contact

à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œ
>Pâ€™ Jum â€” AIoT R&D & Sourcing Manager   
>Pink - Assistance  
>D.T.C. Enterprise
